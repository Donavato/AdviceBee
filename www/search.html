<!DOCTYPE <!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--reference style sheet-->
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link rel="stylesheet" type="text/css" href="css/popup.css" />
    <link rel="stylesheet" type="text/css" href="css/main.css" />
    <link rel="stylesheet" type="text/css" href="css/navigation.css" />
    <link rel="stylesheet" type="text/css" href="css/notification.css" />
    <link rel="stylesheet" type="text/css" href="css/search.css" />
    
    
</head>

<body>
    <h1 class="generalTitle">Search</h1>
    <hr><br>
    <input type="text" class="input" placeholder="Search..." name="search" id="search_content" minlength=3>
    <br>
    <button type="submit" id="Search" class="btn search" onclick="stringlength()">Enter</button>
    <br>
    <!-- TABS WITH ONCLICK EVENTS TO CALL FUNCTIONS FOR DATA DISPLAY -->
    <div class="tab">
        <button class="tablinks" id="Q1" onclick="openCity(event, 'Questions')">Questions</button>
        <!-- <button class="tablinks" id="A1" onclick="openCity(event, 'Advices')">Advices</button> -->
        <button class="tablinks" id="U1" onclick="openCity(event, 'Users')">Users</button>
    </div>
    <hr>
    <br><br>
    <!-- TABS THAT HAVE INFO TO DISPLAY  -->
    <!-- PARSE DATA FROM DB INTO THESE ID'S DISPLAY IS ALREADY FUNCTIONAL -->
    <div id="Questions" class="tabcontent" style="display:block;">
        <h3>Questions</h3>
        <div id="Q">
            <h4>None</h4>
        </div>
    </div>
    <!-- <div id="Advices" class="tabcontent" style="display:block;">
        <h3>Advices</h3>
        <div id="A">
            <h4>None</h4>
        </div>
    </div> -->
    <div id="Users" class="tabcontent" style="display:block;">
        <h3>Users</h3>
        <div id="U">
            <h4>None</h4>
        </div>
    </div>
    <br>

    <!--Need to update page links. Ran into issues with img src links when in folders-->
    <div class="icon-location">
        <div class="icon-bar">
            <a href="index.html"><img src="images/NavBar/home.png"></a>
            <a href="groups.html"><img src="images/NavBar/groups.png"></a>
            <a href="notification.html" class="badge1" data-badge=""><img src="images/NavBar/notification.png"></a>
            <a href="search.html"><img src="images/NavBar/search.png"></a>
            <a href="listfolloweduser.html"><img src="images/NavBar/users.png"></a>
            <a href="listlikequestion.html"><img src="images/NavBar/favorite.png"></a>
            <a href="profile.html"><img src="images/NavBar/profile.png"></a>
        </div>
    </div>
    <div class="hover-bkgr-fricc">
        <!--Add this div to page for pop up-->
        <span class="helper"></span>
        <div>

            <p id="popuptext" class="popupText"></p>
            <!--Append popup here-->
        </div>
    </div>

    <script type="text/javascript">
        //CALLED FUNCTION TO CHANGE CONTENT FOCUS ON ACTIVE TAB SELECTED
        function openCity(evt, focus) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(focus).style.display = "block";
            evt.currentTarget.className += " active";
        }
        // $(document).ready(function () {
        // });
        function stringlength() {
            var field = $("#search_content").val();
            var mnlen = 3;
            var mxlen = 10;

            if (field.length < mnlen || field.length > mxlen || !field) {
                popup("Please enter a search between " + mnlen + " to " + mxlen + " charecters long.")
                return false;
            }
            else {
                var search_data = $("#search_content").val();
                var dataString = "Data=" + search_data;
                $.ajax({
                    type: "POST",
                    url: "http://localhost/api/search.php",
                    dataType: "json",
                    data: dataString,
                    success: function (data) {
                        showTabs();
                        document.getElementById("Q").innerHTML = "";
                        // document.getElementById("A").innerHTML = "";
                        document.getElementById("U").innerHTML = "";

                        var QUE = $('#Q');
                        // var ADV = $('#A');
                        var USE = $('#U');

                        //APPEND DATA INTO DIV ID'S OF THE TABS
                        for (var x = 0, leng = data[0].Users.length; x < leng; x++) {
                            var item = data[0].Users[x];
                            USE.append("<div id='searchElement' onclick='sendUser(" + item.user_ID + ")'>" + "<p>" + item.f_name + " " + item.l_name + " " + item.email + "</p>" + "</div>" + "<br>");
                        }
                        for (var x = 0, leng = data[0].Questions.length; x < leng; x++) {
                            var item = data[0].Questions[x];
                            QUE.append("<div id='searchElement' onclick='sendQuestion(" + item.Question_ID + ")'>" + "<div id='searchSubject'>" + item.Subject + "</div>" + "<br> " + "<p>" + item.Description + "</p>" + "</div>" + "<br>");
                        }
                        // for (var x = 0, leng = data[0].Advice.length; x < leng; x++) {
                        //     var item = data[0].Advice[x];
                        //     ADV.append("<div id='searchElement' onclick='sendQuestion(" + item.Question_ID + ")'>" + "<div id='searchSubject'>" + item.Subject + "</div>" + "<br> " +
                        //         "<p>" + item.Description + "</p>" + "<p>" + item.advice + " " + "</p>" + "<div>" + "<br>");
                        // }
                        //LOCK TABS IF THEY ARE EMPTY
                        if ($(QUE).text().length == 0) {
                            $('#Q1').hide();
                            QUE.append("<h4>" + "None" + "<h4>");
                        }
                        // if ($(ADV).text().length == 0) {
                        //     $('#A1').hide();
                        //     ADV.append("<h4>" + "None" + "<h4>");
                        // }
                        if ($(USE).text().length == 0) {
                            $('#U1').hide();
                            USE.append("<h4>" + "None" + "<h4>");
                        }
                    }
                });
            }
        }

        function showTabs() {
            $('#Q1').show();
            // $('#A1').show();
            $('#U1').show();
        }
        function sendQuestion(questionID) {
            sessionStorage.questionID = questionID;
            window.location.replace("advice.html");
        }
        function sendUser(uID) {
            sessionStorage.user_id = uID;
            window.location.replace("profile.html");
        }

    </script>
    <script src="js/notification.js"></script>
    <script src="js/popup.js"></script>
</body>

</html>