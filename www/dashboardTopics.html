<head>
    <link rel="stylesheet" href="style.css">
    <!--dashboardTopics stylesheet-->
    <link rel="stylesheet" type="text/css" href="css/dashboardTopics.css" />
</head>
<div id="topicsButtons">

</div>

<script type="text/javascript">
    //call ajax
    var ajax = new XMLHttpRequest();
    var method = "GET";
    var url = "http://localhost/api/Profile/dashboardTopics.php";
    var asynchronous = true;

    ajax.open(method, url, asynchronous);

    //sending ajax
    ajax.send();

    //recieve response
    ajax.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            //converting JSON to array
            var data = JSON.parse(this.responseText);

            //append to html
            var html = "";

            for (var a = 0; a < data.length; a++) {
                //set array information for current topic in variables
                var id = data[a].Topic_ID;
                var name = data[a].Topic_name;
                var imageURL = data[a].topicImage;

                //create button for each topic to display questions
                html += "<li><button class='makeCircleButton' id=" + id + " value=" + name + " onclick='displayQuestions(this.value, this.id)'><img src='" + imageURL + "' class='makeCircle'></button>";
                html += "<p class='textsize'>" + name + "</p></li>";

                //replace in html
                document.getElementById("topicsButtons").innerHTML = html;
            }
        }
    }
</script>

<script type="text/javascript">
    
    function displayQuestions(obj, tID) {
        var topic_name = obj;
        sessionStorage.setItem('topic_obj', obj);
        var topic_ID = tID;

        //call ajax
        $(document).ready(function () {
            sessionStorage.removeItem('topic_id');
            sessionStorage.setItem('topic_id', topic_ID);
            $.ajax({
                method: "POST",
                url: "http://localhost/api/Profile/displaytopicquestions.php",
                data: { Topic_Name: topic_name },
                //on success it will call this function
                success: function (data) {
                    var topicsButtons = $('#DOM');
                    var arrayQuestions = data;

                    //empty the current div from questions to post the new questions from the topic selected
                    topicsButtons.empty();
                    //GET DATA AND PARSE IT
                    $.each(arrayQuestions, function (key, value) {

                        //APPEND DATA AND DISPLAY IT
                        
                        value.dImage = (value.dImage === "<img src = >") ? '' : value.dImage;
                        topicsButtons.append(`
                            <div class="post">
                                ${value.pImage}
                                <div class="main-body">
                                    <div class="post-header">
                                        <span>${value.name}</span>
                                        <div class="subject">${value.Subject}</div>
                                    </div>
                                    <div class="post-body">
                                            ${value.dImage}
                                            <div class="description">${value.Description}</div>
                                    </div>
                                    <div class="post-footer" style="font-size: 1.2rem;"> 
                                        <div>
                                            <i class="far fa-comment" onclick="sendButton(${value.Question_ID})"></i>
                                            ${value.c_count}
                                        </div>
                                        <i class="fas fa-exclamation" onclick="reportButton(${value.Question_ID})"></i>
                                        <i class="far fa-user" onclick="followButton(${value.Question_ID} , ${value.user_ID2})"></i>
                                        
                                        <div id="u_Heart">
                                        <i class="far fa-heart" onclick="likeButtonTopics(${value.Question_ID})"></i>${value.likes}<!-- unfilled -->
                                        </div>

                                        <!--<i class="far fa-heart" onclick="reportButton(${value.Question_ID})"></i> filled -->
                                        <i class="far fa-share-square" onclick="sendButton(${value.Question_ID})"></i>

                                    </div>
                                </div>
                            </div>
                            `)

                    });
                    //if fail it will give this error
                }, error: function (e) {
                    popup("failed to work");
                }

            });

        });
    }


    function likeButtonTopics(questionID) {

    var Question_ID = questionID;
    var dataString = "Question_ID=" + Question_ID;

        $.ajax({
            url: "http://localhost/api/Question/likequestion.php",
            type: "POST",
            dataType: "json",
            data: dataString,
            //on success it will call this function
            success: function (data) {
                var topic_obj = sessionStorage.getItem("topic_obj");
                var tID = sessionStorage.getItem("topic_id");
                popup(data);
                displayQuestions(topic_obj, tID);
                
            }

        });
    }


</script>

