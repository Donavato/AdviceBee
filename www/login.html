<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <!--initialize jquery from js folder-->
    <script src="js/jquery-3.3.1.min.js"></script>
<!--Remove later -->
    <!-- <script
            src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script> -->
    <!--reference style sheet-->
    <!--<link rel="stylesheet" href="style.css">-->
    <!--Popup style sheet-->
    <link rel="stylesheet" type="text/css" href="css/popup.css"/>
    <!--Facebook and Google icon source-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,900" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/login.css">
</head>

<body>
<h3 class="title">Please Sign In</h3>
<div class="alt-login">
    <a href="#" class="fb btn">
        <i class="fa fa-facebook fa-fw"></i> <span>Login with Facebook</span>
    </a>
    <a href="#" class="google btn">
        <i class="fa fa-google fa-fw"></i>  <span>Login with Google+</span>
    </a>
</div>
<div class="login-or">
    <hr>
    <span>or</span>
    <hr>
</div>
<div class="inputs">
    <input type="text" class="input" placeholder="Enter email" id="email" required>
    <input type="password" class="input" placeholder="Enter password" id="passwrd" required>
    <a href="pwreset.html" class="hyperlink">Forgot your password?</a>
</div>
<div class="sumbit-button-center">
    <button type="button" id="submit" class="btn submit">Sign In</button>
</div>
<p class="create-account">Dont have one?<a href="register.html" class="reglink"> Create one now!</a></p>




<nav class="nav">
    <a href="insert.html" class="link">Insert</a>
    <a href="delete.html" class="link">Delete</a>
    <a href="index.html" class="link">Show Data</a>
    <a href="login.html" class="link">Login</a>
    <a href="register.html" class="link">Register</a>
    <a href="changepw.html" class="link">Change PW</a>
    <a href="pwreset.html" class="link">Password Reset</a>
    <a href="logout.html" class="link">Logout</a>
</nav>


<div id="response">

</div>

<div class="hover-bkgr-fricc">      <!--Add this div to page for pop up-->
    <span class="helper"></span>
    <div>
        <p id="popuptext" class="popupText"></p>          <!--Append popup here-->
    </div>
</div>
<!-- FIX THE SUCCESS/FAIL RESPONSE TYPE -->
<!--Implementation of jquery/ajax-->

<script src="js/popup.js"></script>
<script type="text/javascript">
    $('#submit').on('click', function (e) {
        e.preventDefault()
        var email = $("#email").val();
        var password = $("#passwrd").val();
        var dataString = "email=" + email + "&passwrd=" + password;
        $.ajax({
            url: "http://10.0.2.2/api/Account/login.php",
            type: "POST",
            dataType: "json",
            data: dataString,
            success: function(data){

                if(data==true){
                    //call ajax
                    var ajax = new XMLHttpRequest();
                    var method = "GET";
                    var url = "http://10.0.2.2/api/Account/fts.php";
                    var asynchronous = true;

                    ajax.open(method, url, asynchronous);

                    //sending ajax
                    ajax.send();

                    //recieve response
                    ajax.onreadystatechange = function()
                    {
                        if(this.readyState == 4 && this.status == 200)
                        {
                            var data = JSON.parse(this.responseText);

                            if (data[0].fts == 0) {
                                window.location.replace("topics.html");
                            }
                            else {
                                window.location.replace("index.html");
                            }
                        }
                    }
                } else {
                    console.log(data);
                    //popup("Login Failed");
                    popup("Login failed");
                }

            }, error: function(e){
                popup(JSON.stringify(e));
            }
        });
    });
    function activate(){

    }
</script>
</body>

</html>