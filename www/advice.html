<html>

<head>
    <script src="js/jquery-3.3.1.min.js"></script>

</head>

<body>

    <p id="Question"></p>

    <div id="advices">
    </div>
    
    <form action="api/Advice/giveAdvice.php" method="POST">
        <div id="advice">
        </div>
        <div id="FormID">

        </div>
        <br>
        <input type="submit" value="Submit">
    </form>

    <!-- GET ID FROM URL -->
    <script type="text/javascript">
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {
                    return pair[1];
                }
            }
            return (false);
        }
        var Question_ID = getQueryVariable("Question");

        $(document).ready(function () {
            var dataString = "Question_ID=" + Question_ID;
            //LIST ADVICES GIVEN FOR EACH PARTICULAR QUESTION
            $.ajax({
                url: "http://localhost/api/Advice/listadvices.php",
                type: "POST",
                dataType: "json",
                data: dataString,
                //on success it will call this function
                success: function (data) {
                    var DOM = $('#advices');

                    $.each(data, function (key, value) {
                        DOM.append("<p>" + value.advice + "</p>");
                    });

                }, error: function (e) {
                    alert("failed to work");
                }
            });

            $.ajax({
                url: "http://localhost/api/Advice/Advice.php",
                type: "POST",
                dataType: "json",
                data: dataString,
                //on success it will call this function
                success: function (data) {
                    var Obj = JSON.parse(JSON.stringify(data));
                    document.getElementById("Question").innerHTML = "<h3>" + Obj[0].Subject + "</h3><br>" + Obj[0].topic + "<br>" + Obj[0].Description + "<br>" + Obj[0].question_type;

                    // CHECK QUESTION TYPE, OUTPUT FORM ADVICE DEPENDING ON THAT TYPE
                    document.getElementById("FormID").innerHTML = "<input type='hidden' name='Question_ID' value='"+ Question_ID+ "'/>";
                    
                    
                    if (Obj[0].question_type == "Yes or No") {
                        document.getElementById("advice").innerHTML = "Yes: " + "<input type='radio' name='advice' value='Yes' />" + "<br>" + "No: " + "<input type='radio' name='advice' value='No' />";
                    } else if (Obj[0].question_type == "True or False") {
                        document.getElementById("advice").innerHTML = "True: " + "<input type='radio' name='advice' value='True' />" + "<br>" + "False: " + "<input type='radio' name='advice' value='False' />";
                    } else if (Obj[0].question_type == "Description") {
                        document.getElementById("advice").innerHTML = "<div id='Description'" + "Advice: " + "<br>" + "<textarea name='advice' id='value'>" + "</textarea>" + "<br>" + "</div>";
                    } else {
                        document.getElementById("advice").innerHTML = "Error";
                    }

                    //if fail it will give this error
                }, error: function (e) {
                    alert(JSON.stringify(e));
                }
            });
        });
    </script>
</body>

</html>