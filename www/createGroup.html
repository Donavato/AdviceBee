<html>
    <head>
        <!--initialize jquery from js folder-->
        <script src="js/jquery-3.3.1.min.js"></script>
        <!--reference style sheet-->
        <link rel="stylesheet" href="style.css">
        <!--Popup style sheet-->
        <link rel="stylesheet" type="text/css" href="css/popup.css"/>
        <meta http-equiv="Content-Security-Policy" content=" style-src 'self' 'unsafe-inline'; 
                media-src *; 
                script-src 'self' 'unsafe-inline';
                img-src 'self' data: content:;">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <style>
            #msg{
                border: 1px solid #eee;
                padding: 1rem;
                margin: 1rem;
            }
        </style>
    </head>
        <body>
                <!--button layout-->
                <h1 class="h1">Create a Group</h1><hr>
            
                <div class="list">
                    <input type="hidden" id="id" value="" />
                    
                        <input type="text" id="Subject" maxlength="30" value="" placeholder="Group name" /><br>
                        <textarea id="Description" placeholder="Group description"></textarea>
                        <p class="charactercount">
                            <span id="wordCount">250</span>/250 characters
                        </p>
                    
                    <div class="optionbox">
                        <div class="insertbox">
                            <label class="label">Topic: </label><br>
                            <select id="topics_list" class="select"></select>
            
                            <div class="imageupload">
                                <img id="photo" />
                                <input type="button" id="btn" value="Take" class="uploadbutton" />
                                <input type="button" id="btn2" value="Upload" class="uploadbutton" />
                            </div>
                        </div> 
                    </div>
                    <br>
                    <div class="item">
                        <input type="button" id="cancel" value="Cancel" class="cancel" />
                        <input type="button" id="insert" value="Insert" class="create" />
                    </div>
                    
                </div>
                <br>
            
                <!--Nav bar at the bottom of the page-->
                <div class="icon-location">
                    <div class="icon-bar">
                        <a href="index.html"><img src="images/NavBar/home.png" onclick="clearTopicID()"></a>
                        <a href="groupinfo.html"><img src="images/NavBar/groups.png" onclick="clearTopicID()"></a>
                        <a href="notification.html" class="badge1" data-badge=""><img src="images/NavBar/notification.png" onclick="clearTopicID()"></a>
                        <a href="search.html"><img src="images/NavBar/search.png" onclick="clearTopicID()"></a>
                        <a href="listfolloweduser.html"><img src="images/NavBar/users.png" onclick="clearTopicID()"></a>
                        <a href="listlikequestion.html"><img src="images/NavBar/favorite.png" onclick="clearTopicID()"></a>
                        <a href="profile.html"><img src="images/NavBar/profile.png" onclick="clearTopicID()"></a>
                    </div>
                </div>
            
                 <div class="hover-bkgr-fricc">      <!--Add this div to page for pop up-->
                    <span class="helper"></span>
                    <div>
                         
                        <p id="popuptext" class="popupText"></p>          <!--Append popup here-->
                    </div>
                </div>
    
                <script type="text/javascript" src="cordova.js"></script>
                <script>
                    var image_Content;
                    let app = {
                        //wait for button to be clicked
                        init: function () {
                            //when one is clicked, send to option selected
                            document.getElementById('btn').addEventListener('click', app.takephoto);
                            document.getElementById('btn2').addEventListener('click', app.pullphoto);
                        },
                        //when button clicked start this function
                        takephoto: function () {
                            //options for camera function
                            let opts = {
                                quality: 25,                                           //Set the quality of image
                                destinationType: Camera.DestinationType.DATA_URL,      //Set the filetype of image
                                sourceType: Camera.PictureSourceType.CAMERA,           //Set the source of image (camera or library)
                                mediaType: Camera.MediaType.PICTURE,                   //Declare media type as Picture
                                encodingType: Camera.EncodingType.JPEG,                //Image type JPEG or PNG
                                cameraDirection: Camera.Direction.BACK,                //Front or back Camera
                                targetWidth: 55,                                      //Width by pixles
                                targetHeight: 55                                      //Height by pixles
                            };
                            //navigate the page to the camera on the mobile app
                            navigator.camera.getPicture(app.success, app.fail, opts);
                        },
                        pullphoto: function () {
                            //options for Upload function
                            let opts = {
                                quality: 25,                                         
                                destinationType: Camera.DestinationType.DATA_URL,
                                sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
                                mediaType: Camera.MediaType.PICTURE,
                                encodingType: Camera.EncodingType.JPEG,
                                cameraDirection: Camera.Direction.BACK,
                                targetWidth: 55,
                                targetHeight: 55
                            }
                            navigator.camera.getPicture(app.success, app.fail, opts);
                        },
                        //ON SUCCESS use image URI file type. this is a string file type
                        success: function (imageData) {
                            var image = document.getElementById('photo');             //Take html of photo and put it in "image"
                            image.src = "data:image/jpeg;base64," + imageData;        //Make the src element of the image html tag and change it
                            image_Content = "data:image/jpeg;base64," + imageData;    //package the imagedata and string needed into the global variable
                        },
                        //FUNCTION FAILED
                        fail: function (response) {
                            popup("Image failed");    //why did it fail, display it
                        }
                    };
            
                    document.addEventListener('deviceready', app.init);               //Another way to do document on ready
            
                </script>
                

                <script type="text/javascript">
                    $(document).ready(function () {
                        //PULL ALL TOPICS AND STORE THEM INTO A DROP DOWN FOR topics_list
                        $.ajax({
                            type: "POST",
                            url: "http://localhost/api/topics.php",
                            success: function (response) {
                                var data = JSON.parse(JSON.stringify(response));
                                var text = "";
                                text = data.reduce((acc, item) => "<option value='" + item + "'>" + item + "</option>" + acc, '')
                                document.getElementById("topics_list").innerHTML = text;
                            }
                        });
                    })

                    $("#insert").click(function () {
                        //set default group image here
                        if(!image_Content){
                            image_Content = null;
                        }
                        var Description = $("#Description").val();
                        var Subject = $("#Subject").val();
                        var topic = $('#topics_list').val();
                        if ($.trim(Description).length > 0 & $.trim(Subject).length > 0) {
                            $.ajax({
                            url: "http://localhost/api/createGroup.php",
                            type: "POST",
                            data: {
                                base64: image_Content,
                                Description: Description,
                                Subject: Subject,
                                topic: topic,
                                image: image_Content,
                                insert: true
                            },
                            success: function (data) {
                                if (data == "success") 
                                {
                                    popup("inserted");
                                    $("#insert").val('submit');
                                    window.location.href = "groupinfo.html";

                                }
                                else
                                {
                                    popup(data);
                                } 
                                    
                            }
                        });
                        }
                    });
                </script>

        <script type="text/javascript">
            //grab and store elements into variables
            var Description = document.getElementById("Description");
            var wordCount = document.getElementById("wordCount");
            
            //add event for each time a key is released to run the function
            Description.addEventListener("keyup",function() {
                var numOfCharacters = Description.value.split('');
                wordCounts = 250 - numOfCharacters.length;
                wordCount.innerText = wordCounts;
            });
        </script>

        <script type="text/javascript">
            function popup(text){
                //set popupText to the <p> tag in the div
                var popupText = $('#popuptext');
                //empty the <p> tag in case of prior pop ups
                popupText.empty();
                //append new text passed through the function to the <p> tag
                popupText.append(text);
                //show when pop up is called
                const popup = $('.hover-bkgr-fricc');
                popup.show();
                //hide when the x is clicked or anywhere else on the page is clicked
                popup.click(function(){
                    popup.hide();
                });
                $('.popupCloseButton').click(function(){
                    popup.hide();
                });
            }
        </script>
            
    </body>
</html>