<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <head>
        <title>Profile</title>
        <link rel="stylesheet" href="style.css"/>
        <link rel="stylesheet" href="css/profile.css"/>
        <!--reference style sheet-->
        <link rel="stylesheet" href="style.css">
        <!--Popup style sheet-->
    <link rel="stylesheet" type="text/css" href="css/popup.css"/>
        <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
            //intial loadup on page
            $("#wallpaper").load("wallpaper.html");
        });
        </script>
        <script type="text/javascript">
            $(document).ready(function(){
            //intial loadup on page
            $("#profile_picture").load("avatar.html");
        });
        </script>
        <script type="text/javascript">
           $(document).ready(function(){
               //intial loadup on page
               $("#content").load("info.html");

               //menu clicks
               $('ul#nav li a').click(function(){
                    var page = $(this).attr('href');
                    $('#content').load(page + '.html');
                    return false;
                });
            });
        </script>

    </head>
    <body>
        <div id="wallpaper">

        </div>
        <div id="profile_picture">

        </div>
        <br><br>
        <table>
            <tbody id="getpublicinfo"> <!-- data will be displayed here -->
        
            </tbody>
        </table>

        <ul id="nav">
            <li><a href="info">Info</a></li>
            <li><a href="topicinfo">Topics</a></li>
            <li><a href="groupinfo">Groups</a></li>
        </ul>
        <div id="content">
            
        </div>
        <br>
        <nav class="nav">
            <a href="insert.html" class="link">Insert</a> |
            <a href="delete.html" class="link">Delete</a> |
            <a href="index.html" class="link">Show Data</a> |
            <a href="login.html" class="link">Login</a> |
            <a href="register.html" class="link">Register</a> |
            <a href="changepw.html" class="link">Change PW</a> |
            <a href="pwreset.html" class="link">Password Reset</a> |
            <a href="profile.html" class="link">Profile</a>
        </nav>

        <div class="icon-location">
            <div class="icon-bar">
                <a href="listlikepost.html"><img src="images/NavBar/list.png"></a>
                <a href="groups.html"><img src="images/NavBar/groups.png"></a>
                <a href="notification.html"><img src="images/NavBar/notification.png"></a>
                <a href="search.html"><img src="images/NavBar/search.png"></a>
                <a href="listfolloweduser.html"><img src="images/NavBar/users.png"></a>
                <a href="listlikequestion.html"><img src="images/NavBar/favorite.png"></a>
                <a href="profile.html"><img src="images/NavBar/profile.png"></a>
            </div>
        </div>
        <div class="hover_bkgr_fricc">      <!--Add this div to page for pop up-->
            <span class="helper"></span>
            <div>
                 
                <p id="popuptext" class="popupText"></p>          <!--Append popup here-->
            </div>
        </div>
    </body>
</html>

<script type="text/javascript">
    
        //call ajax
        var ajax = new XMLHttpRequest();
        var method = "GET";
        var url = "http://10.0.2.2/api/Profile/getinfo.php";
        var asynchronous = true;
        
        ajax.open(method, url, asynchronous);
        
        //sending ajax
        ajax.send();
        
        //recieve response from getinfo.php
        ajax.onreadystatechange = function()
        {
            if(this.readyState == 4 && this.status == 200)
            {
                //converting JSON taken from getinfo.php to array
                var data = JSON.parse(this.responseText); 
                
                //html value for <tbody>
                var html = "";
                
                //setting varaibles to use for profile
                var Email = data[0].email;
                var f_name = data[0].f_name;
                var l_name = data[0].l_name;
                var title = data[0].title;
                var points = data[0].points;
                var location = data[0].location;
                var age = data[0].age;
                var level = data[0].level;

                var img = document.createElement("img");
                if (level == "Bronze")
                {
                    img.src = "images/Bronze.png";
                }
                else if(level == "Silver")
                {
                    img.src = "images/Silver.png";
                }
                else if (level == "Gold")
                {
                    img.src = "images/Gold.png";
                }

                
                //combining first name and last name with a space between them
                var fullName= f_name + '\xa0' + l_name;

                //tie into html
                html += "<tr>";
                    html += "<td align=left>Credit: " + points + " pts</td>";
                    html += "<div id='level' align=right><td></td></div>";
                html += "</tr>";
                html += "<tr align=center>";
                    html += "<input type='text' name = username value="+ fullName +" onchange='editName(this)'>";
                html += "</tr>";
                html += "<tr align='center'>";
                        html += "<input type='text' name = userTitle value="+ title +" onchange='editTitle(this)'>";
                html += "</tr>";
                html += "<tr align='center'>";
                        html += "<input type='text' name = userLocation value="+ location +" onchange='editLocation(this)'>";
                html += "</tr>";

                //replace <tbody> of table in html
                document.getElementById("getpublicinfo").innerHTML = html;
            }
            var src = document.getElementById("level");
            $(document).ready(src.appendChild(img));
        
        }
</script>

<script type="text/javascript">

	function editName(obj) 
	{
		//store the names into variables
		var storeName = obj.value.split(/[' ''\xa0']/);
        var firstName = storeName[0];
        storeName.shift();
        var lastName = storeName.join(' ');
        

		//call ajax
		$.ajax({
			method: "POST",
			url: "http://10.0.2.2/api/Profile/updatename.php",
			data: {userfirstName: firstName, userlastName: lastName}
        });
    }

    function editTitle(obj)
    {
        //store the title into variable
		var storeTitle = obj.value;
		
        //call ajax
        $.ajax({
            method: "POST",
            url: "http://10.0.2.2/api/Profile/updatetitle.php",
            data: {userTitle: storeTitle}
        });
    }

    function editLocation(obj)
    {
        //store the location into variable
		var storeLocation = obj.value;
		
        //call ajax
        $.ajax({
            method: "POST",
            url: "http://10.0.2.2/api/Profile/updatelocation.php",
            data: {userLocation: storeLocation}
        });
    }
</script>

<script type="text/javascript">
    //add this function to for pop up functionality
    function popup(text){
        //set popupText to the <p> tag in the div
        var popupText = $('#popuptext');
        //empty the <p> tag in case of prior pop ups
        popupText.empty();
        //append new text passed through the function to the <p> tag
        popupText.append(text);
        //show when pop up is called
        $('.hover_bkgr_fricc').show();
        //hide when the x is clicked or anywhere else on the page is clicked
        $('.hover_bkgr_fricc').click(function(){
            $('.hover_bkgr_fricc').hide();
        });
        $('.popupCloseButton').click(function(){
            $('.hover_bkgr_fricc').hide();
        });
    }
    </script>