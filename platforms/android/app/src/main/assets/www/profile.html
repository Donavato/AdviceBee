<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <head>
        <title>Profile</title>
        <link rel="stylesheet" href="style.css"/>
        <link rel="stylesheet" href="css/profile.css"/>
        <!--reference style sheet-->
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript">
           $(document).ready(function(){
               //intial loadup on page
               $("#content").load("info.html");

               //menu clicks
               $('ul#nav li a').click(function(){
                    var page = $(this).attr('href');
                    $('#content').load(page + '.html');
                    return false;
                });
            });
        </script>

    </head>
    <body>
        <table>
            <tbody id="getpublicinfo"> <!-- data will be displayed here -->
        
            </tbody>
        </table>

        <ul id="nav">
            <li><a href="info">Info</a></li>
            <li><a href="topicinfo">Topics</a></li>
            <li><a href="groupinfo">Groups</a></li>
        </ul>
        <div id="content">
            
        </div>
        <br>
        <nav class="nav">
            <a href="insert.html" class="link">Insert</a> |
            <a href="delete.html" class="link">Delete</a> |
            <a href="index.html" class="link">Show Data</a> |
            <a href="login.html" class="link">Login</a> |
            <a href="register.html" class="link">Register</a> |
            <a href="changepw.html" class="link">Change PW</a> |
            <a href="pwreset.html" class="link">Password Reset</a> |
            <a href="profile.html" class="link">Profile</a>
        </nav>

        <div class="icon-location">
            <div class="icon-bar">
                <a href="listlikepost.html"><img src="list.png"></a>
                <a href="groups.html"><img src="groups.png"></a>
                <a href="notification.html"><img src="notification.png"></a>
                <a href="search.html"><img src="search.png"></a>
                <a href="users.html"><img src="users.png"></a>
                <a href="favorite.html"><img src="favorite.png"></a>
                <a href="profile.html"><img src="profile.png"></a>
            </div>
        </div>
    </body>
</html>

<script>
        //call ajax
        var ajax = new XMLHttpRequest();
        var method = "GET";
        var url = "http://10.0.2.2/api/Profile/getinfo.php";
        var asynchronous = true;
        
        ajax.open(method, url, asynchronous);
        
        //sending ajax
        ajax.send();
        
        //recieve response from getinfo.php
        ajax.onreadystatechange = function()
        {
            if(this.readyState == 4 && this.status == 200)
            {
                //converting JSON taken from getinfo.php to array
                var data = JSON.parse(this.responseText);
                console.log(data); 
                
                //html value for <tbody>
                var html = "";
                
                //setting varaibles to use for profile
                var Email = data[0].email;
                var f_name = data[0].f_name;
                var l_name = data[0].l_name;
                var title = data[0].title;
                var points = data[0].points;
                var location = data[0].location;
                var age = data[0].age;
                var level = data[0].level;

                //combining first name and last name with a space between them
                var fullName= f_name + '\xa0' + l_name;

                //tie into html
                /*html += "<tr>";
                    html += "<td>" + f_name + "</td>";
                html += "</tr>";
                html += "<tr>";    
                    html += "<td>" + l_name + "</td>";
                html += "</tr>";
                html += "<tr>";
                    html += "<td>" + title + "</td>";
                html += "</tr>";
                html += "<tr>";
                    html += "<td>" + points + "</td>";
                html += "</tr>";
                html += "<tr>";
                    html += "<td>" + location + "</td>";
                html += "</tr>";
                html += "<tr>";
                    html += "<td>" + level + "</td>";
                html += "</tr>";*/
                html += "<tr>";
                    html += "<td align=left>Credit: " + points + " pts</td>";
                    html += "<td align=right>"+ level + "</td>";
                html += "</tr>";
                html += "<tr align=center>";
                    html += "<input type='text' name = username value="+ fullName +" onchange='editName(this)'>";
                html += "</tr>";
                html += "<tr align='center'>";
                        html += "<input type='text' name = userTitle value="+ title +" onchange='editTitle(this)'>";
                html += "</tr>";
                html += "<tr align='center'>";
                        html += "<input type='text' name = userLocation value="+ location +" onchange='editLocation(this)'>";
                html += "</tr>";

                //replace <tbody> of table in html
                document.getElementById("getpublicinfo").innerHTML = html;
            }
        }
</script>

<script type="text/javascript">

	function editName(obj) 
	{
		//store the names into variables
		var storeName = obj.value.split(/[' ''\xa0']/);
        var firstName = storeName[0];
        storeName.shift();
        var lastName = storeName.join(' ');
        

		//call ajax
		$.ajax({
			method: "POST",
			url: "http://10.0.2.2/api/Profile/updatename.php",
			data: {userfirstName: firstName, userlastName: lastName}
        });
    }

    function editTitle(obj)
    {
        //store the title into variable
		var storeTitle = obj.value;
		
        //call ajax
        $.ajax({
            method: "POST",
            url: "http://10.0.2.2/api/Profile/updatetitle.php",
            data: {userTitle: storeTitle}
        });
    }

    function editLocation(obj)
    {
        //store the location into variable
		var storeLocation = obj.value;
		
        //call ajax
        $.ajax({
            method: "POST",
            url: "http://10.0.2.2/api/Profile/updatelocation.php",
            data: {userLocation: storeLocation}
        });
    }
</script>