<head>
		<link rel="stylesheet" href="css/groupinfo.css"/>
</head>
<table>
	<tr>
		<th>Group Names</th>
	<tr>
	
	<tbody id="getgroupinfo">
	
	</tbody>
</table>

<script type="text/javascript">
	//call ajax
	var ajax = new XMLHttpRequest();
	var method = "GET";
	var url = "http://localhost/api/Profile/getusergroupinfo.php";
	var asynchronous = true;
	
	ajax.open(method, url, asynchronous);
	
	//sending ajax request
	ajax.send();
	
	//recieve response from getgroupinfo.php
	ajax.onreadystatechange = function()
	{
		if(this.readyState == 4 && this.status == 200)
		{
			//converting json back to array
			var userdata = JSON.parse(this.responseText);
			
			//html value for <tbody>
			var html = "";
			
			//loop through array for the different groups
			for(var a = 0; a < userdata.length; a++)
			{
				var userGroups = userdata[a].group_name;
			}

			//call ajax
			var ajax = new XMLHttpRequest();
			var method = "GET";
			var url = "http://localhost/api/Profile/getgroupinfo.php";
			var asynchronous = true;
	
			ajax.open(method, url, asynchronous);
	
			//sending ajax request
			ajax.send();
	
			//recieve response from getgroupinfo.php
			ajax.onreadystatechange = function()
			{
				if(this.readyState == 4 && this.status == 200)
				{
					//converting json back to array
					var data = JSON.parse(this.responseText);
			
					//html value for <tbody>
					var html = "";
					
					//cycle through all groups
					for(var c = 0; c < data.length; c++)
					{
						//store group name in variable to call on later
						var groupName = data[c].group_name;
						//store group id in value to use later
						var groupID = data[c].group_id;

						//if user topic array is empty
						if(userdata.length>0)
						{
						
						//cycle through users followed groups
						for(var d = 0; d < userdata.length ; d++)
						{
							//if group id is present in both tables select the button
							if(data[c].group_id == userdata[d].group_id)
							{
								html += "<br>";
								html += "<label class='switch'>";
									html += "<input type='checkbox' name = groupid id= groupID value="+ groupID +" onchange='editGroup(this)' checked>";
									html += "<span class='slider round'>" + groupName + "</span>";
								html += "</label>";
								html += "</br>";
								break;
							}
							//if ran through entire user data array and no match output as unselected
							else if ((d+1)== userdata.length) 
							{
								html += "<br>";
								html += "<label class='switch'>";
									html += "<input type='checkbox' name = groupid id= groupID value="+ groupID +" onchange='editGroup(this)'>";
									html += "<span class='slider round'>" + groupName + "</span>";
								html += "</label>";
								html += "</br>";
							}
						}
					}

					//output all buttons as unselected 
					else
					{
						html += "<br>";
						html += "<label class='switch'>";
							html += "<input type='checkbox' name = groupid id= groupID value="+ groupID +" onchange='editGroup(this)'>";
							html += "<span class='slider round'>" + groupName + "</span>";
						html += "</label>";
						html += "</br>";
					}
			
					}
					//replacing the tbody of table
					document.getElementById("getgroupinfo").innerHTML = html;
					
				}
			}
		}
	}
</script>


<script type="text/javascript">

	function editGroup(obj) 
	{
		//store the clicks id into variable
		var storeID = obj.value;

		if($(obj).is(":checked"))
		{
			//call ajax
			$.ajax({
				method: "POST",
				url: "http://localhost/api/Profile/addusergroup.php",
				data: {groupStoreID: storeID}
  			});
		}
		else
		{
			//call ajax
			$.ajax({
				method: "POST",
				url: "http://localhost/api/Profile/deletefromusergroup.php",
				data: {groupStoreID: storeID}
  			});
		}
	}
</script>